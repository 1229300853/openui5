<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta charset="UTF-8">
<title>ColumnsPanel - sap.m</title>
<script id="sap-ui-bootstrap" src="../../../resources/sap-ui-core.js"
	data-sap-ui-libs="sap.m" data-sap-ui-theme="sap_bluecrystal"
	data-sap-ui-compatVersion="1.20">
	
</script>
<script>
	jQuery.sap.require("jquery.sap.xml");
	jQuery.sap.require("sap.m.P13nColumnsPanel");
	jQuery.sap.require("sap.m.P13nColumnItem");

	var oApp = new sap.m.App("myApp", {
		initialPage: "page1"
	});

	var that = this;
	this._oModel = new sap.ui.model.json.JSONModel();
	
	var _oData = {
			columns: {
					title: sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("PERSODIALOG_TAB_COLUMNS"),
					items: [ {
						key: '4711',
						selected: true,
						visible: true,
						text: "Column1",
						tooltip: "Column1_Tooltip"
					}, {
						key: '4712',
						selected: true,
						visible: true,
						text: "Column2",
						tooltip: "Column2_Tooltip"						
					}, {
						key: '4713',
						selected: false,
						visible: true,
						text: "Column3",
						tooltip: "Column3_Tooltip"						
					},{
						key: '4714',
						selected: true,
						visible: true,
						text: "Column4",
						tooltip: "Column4_Tooltip"						
					} ]
				}
	};

	this._oModel.setData(_oData);

	this._oColumnItemTemplate = new sap.m.P13nColumnItem({
		key: '{key}',
		cells: [ new sap.m.Text({text: '{text}'})],
		visible: '{visible}',
		selected: '{selected}',
		tooltip: '{tooltip}',
		type: sap.m.ListType.Active
	});

	this._oColumnsPanel = new sap.m.P13nColumnsPanel({
		title: "{/columns/title}",
		type: "columns",
		items: {
			path: '/columns/items',
			template: this._oColumnItemTemplate
		},
		moveItem: function(oEvent) {
			that._handleMoveItem(oEvent);
		}
	});

	var oPage = new sap.m.Page("page1", {
		content: [ this._oColumnsPanel ]
	});

	this._oColumnsPanel.setModel(this._oModel)

	this._handleMoveItem = function(oEvent) {
		var oOldItem = null, oNewItem = null;

 		if (oEvent !== null) {
			oOldItem = oEvent.getParameter('oldItem');
			oNewItem = oEvent.getParameter('newItem');
			if (oOldItem !== null && oNewItem !== null) {
		
				// Store old item data
				var bTargetItemIsSelected = oOldItem.getSelected();
				var sTargetItemText = oOldItem.getCells()[0].getText();
				var sTargetItemKey = oOldItem.getKey();

				// Swop item content
				oOldItem.setSelected(oNewItem.getSelected());
				oOldItem.getCells()[0].setText(oNewItem.getCells()[0].getText());
				oOldItem.setKey(oNewItem.getKey());

				oNewItem.setSelected(bTargetItemIsSelected);
				oNewItem.getCells()[0].setText(sTargetItemText);
				oNewItem.setKey(sTargetItemKey);
				
				that._oColumnsPanel._afterMoveItem(oOldItem, oNewItem);
			}
		} 
	};
	
	oApp.addPage(oPage);
	oApp.placeAt("body");
</script>
</head>
<body id="body" class="sapUiBody"></body>
</html>