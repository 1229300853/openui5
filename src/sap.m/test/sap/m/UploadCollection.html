<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

<title>sap.m.UploadCollection</title>
<script src="../../../resources/sap-ui-core.js" id="sap-ui-bootstrap"
	data-sap-ui-libs="sap.m" data-sap-ui-theme="sap_bluecrystal">
</script>

<script type="text/javascript">
	jQuery.sap.initMobile();
	jQuery.sap.require("sap.ui.model.json.JSONModel");
	jQuery.sap.require("sap.m.MessageToast");

	// create JSON sample data
	var oData = {
		"items" : [{
			"contributor" : "Susan Baker",
			"documentId" : "64469d2f-b3c4-a517-20d6-f91ebf85b9da",
			"enableEdit" : true,
			"enableDelete" : true,
			"fileName" : "Screenshot.jpg",
			"fileSize" : 20,
			"mimeType" : "image/jpg",
			"thumbnailUrl" : "",
			"uploadedDate" : "2014-07-30",
			"url" : "/testsuite/test-resources/sap/m/demokit/UploadCollection/Screenshot.jpg"
		}, {
			"contributor" : "John Smith",
			"documentId" : "5082cc4d-da9f-2835-2c0a-8100ed47bcde",
			"enableEdit" : true,
			"enableDelete" : false,
			"fileName" : "Notes.txt",
			"fileSize" : 10,
			"mimeType" : "text/plain",
			"thumbnailUrl" : "",
			"uploadedDate" : "2014-08-01",
			"url" : "/testsuite/test-resources/sap/m/demokit/UploadCollection/Notes.txt"
		}, {
			"contributor" : "J Edgar Hoover",
			"documentId" : "5082cc4d-da9f-2835-2c0a-8100ed47bcdf",
			"enableEdit" : true,
			"enableDelete" : true,
			"fileName" : "Document.txt",
			"fileSize" : 15,
			"mimeType" : "text/plain",
			"thumbnailUrl" : "",
			"uploadedDate" : "2014-09-01",
			"url" : "/testsuite/test-resources/sap/m/demokit/UploadCollection/Document.txt"
		}, {
			"contributor" : "Sean O'Connel",
			"documentId" : "1700ead2-3dfb-5a94-6f5c-cf1da409e028",
			"enableEdit" : false,
			"enableDelete" : true,
			"fileName" : "Third Quarter Results.ppt",
			"fileSize" : 30,
			"mimeType" : "application/vnd.ms-powerpoint",
			"thumbnailUrl" : "",
			"uploadedDate" : "2014-07-29",
			"url" : "/testsuite/test-resources/sap/m/demokit/UploadCollection/Third Quarter Results.ppt"
		}, {
			"contributor" : "Jane Burns",
			"documentId" : "34e484e4-a523-6c50-685b-e5ae66069250",
			"enableEdit" : false,
			"enableDelete" : true,
			"fileName" : "Business Plan Agenda.doc",
			"fileSize" : 40,
			"mimeType" : "application/msword",
			"thumbnailUrl" : "",
			"uploadedDate" : "2014-07-28",
			"url" : "/testsuite/test-resources/sap/m/demokit/UploadCollection/Business Plan Agenda.doc"
		}, {
			"contributor" : "John Black",
			"documentId" : "bcc27c4d-a8ce-3ab6-e807-ec05119685a5",
			"enableEdit" : true,
			"enableDelete" : true,
			"fileName" : "Business Plan Topics.xls",
			"fileSize" : 50,
			"mimeType" : "application/msexcel",
			"thumbnailUrl" : "",
			"uploadedDate" : "2014-07-27",
			"url" : "/testsuite/test-resources/sap/m/demokit/UploadCollection/Business Plan Topics.xls"
		}, {
			"contributor" : "David Keane",
			"documentId" : "6b6ccd2f-e5c2-15b7-3b67-191564850063",
			"enableEdit" : true,
			"enableDelete" : true,
			"fileName" : "Instructions.pdf",
			"fileSize" : 60,
			"mimeType" : "application/pdf",
			"thumbnailUrl" : "",
			"uploadedDate" : "2014-07-26",
			"url" : "/testsuite/test-resources/sap/m/demokit/UploadCollection/Instructions.pdf"
		}, {
			"contributor" : "Kate Brown",
			"documentId" : "b68a7065-cc2a-2140-922d-e7528cd32172",
			"enableEdit" : true,
			"enableDelete" : true,
			"fileName" : "Picture of a woman.png",
			"fileSize" : 70,
			"mimeType" : "image/png",
			"thumbnailUrl" : "images/Woman_04.png",
			"uploadedDate" : "2014-07-25",
			"url" : "/testsuite/test-resources/sap/m/images/Woman_04.png"
		}
		]
	};

	// create JSON model instance
	var oModel = new sap.ui.model.json.JSONModel();

	// set the data for the model
	oModel.setData(oData);

	// set the model to the core
	sap.ui.getCore().setModel(oModel);

	// get current date
	var fnCurrentDate = function() {
		var date = new Date();
		var day = date.getDate();
		var month = date.getMonth() + 1;
		var year = date.getFullYear();

		if (day < 10) {
			day = '0' + day
		};
		if (month < 10) {
			month = '0' + month
		}
		return year + '-' + month + '-' + day;
	};

	/* =========================================================== */
	/* Handle FileUploader events                                  */
	/* =========================================================== */
	var fnChange = function(oEvent){
	};
	var fnFileAllowed = function(oEvent) {
	};
	var fnFileDeleted = function(oEvent) {
		var oData = oModel.getData();
		var aItems = oData.items;
		var sDocumentId = oEvent.getParameter("documentId");
		var bSetData = false;

		jQuery.each(aItems, function(index) {
			if (aItems[index] && aItems[index].documentId === sDocumentId) {
				aItems.splice(index, 1);
				bSetData = true;
			};
		});
		if (bSetData === true) {
			oModel.setData(oData);
		};
	};
	
	var fnFilenameLengthExceed = function(oEvent) {
		sap.m.MessageToast.show(oEvent.getId());
	};
	
	var fnFileRenamed = function(oEvent) {
		var oData = oModel.getData();
		var aItems = oData.items;
		var sDocumentId = oEvent.getParameter("documentId");
		var bSetData = false;

		jQuery.each(aItems, function(index) {
			if (aItems[index] && aItems[index].documentId === sDocumentId) {
				aItems[index].fileName = oEvent.getParameter("fileName");
			};
		});
		oModel.setData(oData);
	};
	var fnFileSizeExceed = function(oEvent) {
		sap.m.MessageToast.show(oEvent.getId());
	};
	var fnTypeMissmatch = function(oEvent) {
		sap.m.MessageToast.show(oEvent.getId());
	};
	var fnUploadAborted = function(oEvent) {
	};
	var fnUploadComplete = function(oEvent) {
		if (oEvent) {
			var oData = oModel.getData();
			var oItem = {};
			var sUploadedFiles = oEvent.getParameters().oSource.mProperties.value;
			sUploadedFiles = sUploadedFiles.substring(1, sUploadedFiles.length - 2);
			var aUploadedFiles = sUploadedFiles.split(/\" "/);
			for (var i = 0; i < aUploadedFiles.length; i++) {
				oItem = {
					"contributor" : "You",
					"documentId" : this.getItems()[i].getId(),
					"fileName" : aUploadedFiles[i],
					"fileSize" : 10, // TODO get file size
					"mimeType" : "",
					"thumbnailUrl" : "",
					"uploadedDate" : fnCurrentDate(),
					"url" : "myUrl"
				};
				oData.items.unshift(oItem);
			};
			oModel.setData(oData);
			sap.m.MessageToast.show("Upload successful");
		}
	};
	var fnUploadProgress = function(oEvent) {
	};

	
	var oItemTemplate = new sap.m.UploadCollectionItem({
		contributor : "{contributor}",
		documentId : "{documentId}",
		enableEdit : "{enableEdit}",
		enableDelete : "{enableDelete}",
		fileName : "{fileName}",
		fileSize : "{fileSize}",
		mimeType : "{mimeType}",
		thumbnailUrl : "{thumbnailUrl}",
		uploadedDate : "{uploadedDate}",
		url : "{url}"
	});

	// create instance of UploadCollection and set model
	var oUploadCollection = new sap.m.UploadCollection({
		items : {
			path : "/items",
			template : oItemTemplate
		},
		maximumFilenameLength : 10,
		maximumFileSize : 1,
		multiple : true,
		// events
		change : fnChange,
		fileAllowed : fnFileAllowed,
		fileDeleted : fnFileDeleted,
		filenameLengthExceed : fnFilenameLengthExceed,
		fileRenamed : fnFileRenamed,
		fileSizeExceed : fnFileSizeExceed,
		typeMissmatch : fnTypeMissmatch,
		uploadAborted : fnUploadAborted,
		uploadComplete : fnUploadComplete,
		uploadProgress : fnUploadProgress
	});
//		}).addStyleClass("sapUiSizeCompact");

	// create a page
	var oPage = new sap.m.Page("page", {
		title : "Test Page for sap.m.UploadCollection",
		content : oUploadCollection
	});

	// create a mobile App embedding the page and place the App into the HTML document
	var app = new sap.m.App("myApp", {
		pages : [oPage]
	}).placeAt("body");
</script>

</head>
<body id="body" class="sapUiBody">
</body>
</html>
