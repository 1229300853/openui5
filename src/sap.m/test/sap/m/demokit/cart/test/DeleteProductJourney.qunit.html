<!DOCTYPE html>
<html>
	<head>
		<title>Shopping Cart Delete Product Journey</title>
		<meta http-equiv='X-UA-Compatible' content='IE=edge'/>
		<meta charset="UTF-8">

		<script
			id='sap-ui-bootstrap'
			src='../../../../../../resources/sap-ui-core.js'
			data-sap-ui-resourceroots='{"sap.ui.demo.cart.test": "./"}'>
		</script>

		<script>
			jQuery.sap.require("sap.ui.qunit.qunit-css");
			jQuery.sap.require("sap.ui.thirdparty.qunit");
			jQuery.sap.require("sap.ui.qunit.qunit-junit");
			jQuery.sap.require("sap.ui.qunit.qunit-coverage");
			jQuery.sap.require("sap.ui.thirdparty.sinon");
			jQuery.sap.require("sap.ui.thirdparty.sinon-qunit");

			sap.ui.require([
					'sap/ui/demo/cart/test/arrangement/DeleteProductJourneyArrangement',
					'sap/ui/test/Opa5',
					'sap/ui/test/opaQunit',
					'sap/ui/demo/cart/test/pageobjects/Home',
					'sap/ui/demo/cart/test/pageobjects/Category',
					'sap/ui/demo/cart/test/pageobjects/Product',
					'sap/ui/demo/cart/test/pageobjects/Cart',
					'sap/ui/demo/cart/test/pageobjects/Dialog'
				],
				function (DeleteProductJourneyArrangement, Opa5, opaTest) {
					//Ensure to add arrangements, action, assertions before loading the page objects,
					//otherwise they would be overwritten.
					Opa5.extendConfig({
						arrangements: new DeleteProductJourneyArrangement(),
						viewNamespace: "view."
					});

					opaTest("Should see the product list", function (Given, When, Then) {
						// Arrangements
						Given.iStartMyApp();

						// Actions
						When.onHome.iPressOnTheSecondCategory();

						// Assertions
						Then.onTheCategory.
							and.iShouldBeTakenToTheSecondCategory().
							and.iShouldSeeTheProductList().
							and.theProductListShouldHaveSomeEntries();
					});

					opaTest("Should add a product to the cart and enable the edit button", function (Given, When, Then) {
						// Actions
						When.onTheCategory.iPressOnTheFirstProduct();
						When.onTheProduct.iAddTheDisplayedProductToTheCart();
						When.onTheCategory.iGoToTheCartPage();

						// Assertions
						Then.onTheCart.iShouldSeeTheProductInMyCart().
							and.theEditButtonShouldBeEnabled();
					});

					opaTest("Should see the delete button after pressing the edit button", function (Given, When, Then) {
						// Actions
						When.onTheCart.iPressOnTheEditButton();

						// Assertions
						Then.onTheCart.iShouldSeeTheDeleteButton();
					});

					opaTest("Should see the confirmation dialog", function (Given, When, Then) {
						// Actions
						When.onTheCart.iPressOnTheDeleteButton();

						// Assertions
						Then.onTheDialog.iShouldBeTakenToTheConfirmationDialog();
					});

					opaTest("Should cancel the delete process", function (Given, When, Then) {
						// Actions
						When.onTheDialog.iPressCancelOnTheConfirmationDialog();

						// Assertions
						Then.onTheCart.iShouldBeTakenToTheCart();
					});

					opaTest("Should delete the product from the cart", function (Given, When, Then) {
						// Actions
						When.onTheCart.iPressOnTheDeleteButton();
						When.onTheDialog.iPressDeleteButtonOnTheConfirmationDialog();

						// Assertions
						Then.onTheCart.iShouldNotSeeAnyItemsInTheCart();
					});

					opaTest("Should see the edit button", function (Given, When, Then) {
						// Actions
						When.onTheCart.iPressOnTheAcceptButton();

						// Assertions
						Then.onTheCart.theEditButtonShouldBeDisabled();

						Then.iTeardownMyAppFrame();
					});

				});
		</script>
	</head>

	<body>
		<div id="qunit"></div>
		<div id="qunit-fixture"></div>
	</body>

</html>